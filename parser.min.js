window._PIDegRatio=Math.PI/180;function toRad(a){return a*(window._PIDegRatio)}window.mMath={unitMode:"DEG",load:function(){var a=this;var c=["sin","cos","tan","asin","acos","atan"],d,b=c.length;while(b--){d=c[b];a[d]=function(e){return Math[d]((a.unitMode=="DEG")?toRad(e):e)}}return a}}.load();if(!Array.indexOf){Array.prototype.indexOf=function(b,c){for(var a=(c||0);a<this.length;a++){if(this[a]===b){return a}}return -1}}var Parser=(function(d){function H(J){function I(){}I.prototype=J;return new I()}var h=0;var q=1;var p=2;var s=3;var w=4;function A(I,K,J,L){this.type_=I;this.index_=K||0;this.prio_=J||0;this.number_=(L!==undefined&&L!==null)?L:0;this.toString=function(){switch(this.type_){case h:return this.number_;case q:case p:case s:return this.index_;case w:return"CALL";default:return"Invalid Token"}}}function G(L,J,I,K){this.tokens=L;this.ops1=J;this.ops2=I;this.functions=K}var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m=/[\\\'\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,v={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","'":"\\'","\\":"\\\\"};function z(I){if(typeof I==="string"){m.lastIndex=0;return m.test(I)?"'"+I.replace(m,function(J){var K=v[J];return typeof K==="string"?K:"\\u"+("0000"+J.charCodeAt(0).toString(16)).slice(-4)})+"'":"'"+I+"'"}return I}G.prototype={simplify:function(R){R=R||{};var M=[];var K=[];var P;var O;var N;var Q=this.tokens.length;var S;var J=0;for(J=0;J<Q;J++){S=this.tokens[J];var I=S.type_;if(I===h){M.push(S)}else{if(I===s&&(S.index_ in R)){S=new A(h,0,0,R[S.index_]);M.push(S)}else{if(I===p&&M.length>1){O=M.pop();P=M.pop();N=this.ops2[S.index_];S=new A(h,0,0,N(P.number_,O.number_));M.push(S)}else{if(I===q&&M.length>0){P=M.pop();N=this.ops1[S.index_];S=new A(h,0,0,N(P.number_));M.push(S)}else{while(M.length>0){K.push(M.shift())}K.push(S)}}}}}while(M.length>0){K.push(M.shift())}return new G(K,H(this.ops1),H(this.ops2),H(this.functions))},substitute:function(J,S){if(!(S instanceof G)){S=new c().parse(String(S))}var P=[];var R=this.tokens.length;var T;var M=0;for(M=0;M<R;M++){T=this.tokens[M];var N=T.type_;if(N===s&&T.index_===J){for(var K=0;K<S.tokens.length;K++){var O=S.tokens[K];var I=new A(O.type_,O.index_,O.prio_,O.number_);P.push(I)}}else{P.push(T)}}var Q=new G(P,H(this.ops1),H(this.ops2),H(this.functions));return Q},evaluate:function(Q){Q=Q||{};var K=[];var O;var N;var M;var P=this.tokens.length;var R;var J=0;for(J=0;J<P;J++){R=this.tokens[J];var I=R.type_;if(I===h){K.push(R.number_)}else{if(I===p){N=K.pop();O=K.pop();M=this.ops2[R.index_];K.push(M(O,N))}else{if(I===s){if(R.index_ in Q){K.push(Q[R.index_])}else{if(R.index_ in this.functions){K.push(this.functions[R.index_])}else{throw new Error("undefined variable: "+R.index_)}}}else{if(I===q){O=K.pop();M=this.ops1[R.index_];K.push(M(O))}else{if(I===w){O=K.pop();M=K.pop();if(M.apply&&M.call){if(Object.prototype.toString.call(O)=="[object Array]"){K.push(M.apply(undefined,O))}else{K.push(M.call(undefined,O))}}else{throw new Error(M+" is not a function")}}else{throw new Error("invalid Expression")}}}}}}if(K.length>1){throw new Error("invalid Expression (parity)")}return K[0]},toString:function(M){var K=[];var P;var O;var N;var Q=this.tokens.length;var R;var J=0;for(J=0;J<Q;J++){R=this.tokens[J];var I=R.type_;if(I===h){K.push(z(R.number_))}else{if(I===p){O=K.pop();P=K.pop();N=R.index_;if(M&&N=="^"){K.push("Math.pow("+P+","+O+")")}else{K.push("("+P+N+O+")")}}else{if(I===s){K.push(R.index_)}else{if(I===q){P=K.pop();N=R.index_;if(N==="-"){K.push("("+N+P+")")}else{K.push(N+"("+P+")")}}else{if(I===w){P=K.pop();N=K.pop();K.push(N+"("+P+")")}else{throw new Error("invalid Expression")}}}}}}if(K.length>1){throw new Error("invalid Expression (parity)")}return K[0]},variables:function(){var I=this.tokens.length;var M=[];for(var J=0;J<I;J++){var K=this.tokens[J];if(K.type_===s&&(M.indexOf(K.index_)==-1)){M.push(K.index_)}}return M},toJSFunction:function(J,K){var I=new Function(J,"with(Parser.values) { return "+this.simplify(K).toString(true)+"; }");return I}};function y(J,I){return Number(J)+Number(I)}function n(J,I){return J-I}function E(J,I){return J*I}function x(J,I){return J/I}function F(J,I){return J%I}function j(J,I){return""+J+I}function b(I){return -I}function a(I){return Math.random()*(I||1)}function l(J){J=Math.floor(J);var I=J;while(J>1){I=I*(--J)}return I}function B(J,I){return Math.sqrt(J*J+I*I)}function D(J,I){if(Object.prototype.toString.call(J)!="[object Array]"){return[J,I]}J=J.slice();J.push(I);return J}function c(){this.success=false;this.errormsg="";this.expression="";this.pos=0;this.tokennumber=0;this.tokenprio=0;this.tokenindex=0;this.tmpprio=0;this.ops1={sin:mMath.sin,cos:mMath.cos,tan:mMath.tan,asin:mMath.asin,acos:mMath.acos,atan:mMath.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,"-":b,exp:Math.exp};this.ops2={"+":y,"-":n,"*":E,"/":x,"%":F,"^":Math.pow,",":D,"||":j};this.functions={random:a,fac:l,min:Math.min,max:Math.max,pyt:B,pow:Math.pow,atan2:Math.atan2};this.consts={E:Math.E,PI:Math.PI}}c.parse=function(I){return new c().parse(I)};c.evaluate=function(I,J){return c.parse(I).evaluate(J)};c.Expression=G;c.values={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sqrt:Math.sqrt,log:Math.log,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,random:a,fac:l,exp:Math.exp,min:Math.min,max:Math.max,pyt:B,pow:Math.pow,atan2:Math.atan2,E:Math.E,PI:Math.PI};var C=1<<0;var r=1<<1;var k=1<<2;var o=1<<3;var e=1<<4;var u=1<<5;var i=1<<6;var g=1<<7;var t=1<<8;c.prototype={parse:function(P){this.errormsg="";this.success=true;var K=[];var Q=[];this.tmpprio=0;var M=(C|o|k|i);var N=0;this.expression=P;this.pos=0;while(this.pos<this.expression.length){if(this.isOperator()){if(this.isSign()&&(M&i)){if(this.isNegativeSign()){this.tokenprio=2;this.tokenindex="-";N++;this.addfunc(Q,K,q)}M=(C|o|k|i)}else{if(this.isComment()){}else{if((M&r)===0){this.error_parsing(this.pos,"unexpected operator")}N+=2;this.addfunc(Q,K,p);M=(C|o|k|i)}}}else{if(this.isNumber()){if((M&C)===0){this.error_parsing(this.pos,"unexpected number")}var J=new A(h,0,0,this.tokennumber);Q.push(J);M=(r|e|u)}else{if(this.isString()){if((M&C)===0){this.error_parsing(this.pos,"unexpected string")}var J=new A(h,0,0,this.tokennumber);Q.push(J);M=(r|e|u)}else{if(this.isLeftParenth()){if((M&o)===0){this.error_parsing(this.pos,'unexpected "("')}if(M&g){N+=2;this.tokenprio=-2;this.tokenindex=-1;this.addfunc(Q,K,w)}M=(C|o|k|i|t)}else{if(this.isRightParenth()){if(M&t){var J=new A(h,0,0,[]);Q.push(J)}else{if((M&e)===0){this.error_parsing(this.pos,'unexpected ")"')}}M=(r|e|u|o|g)}else{if(this.isComma()){if((M&u)===0){this.error_parsing(this.pos,'unexpected ","')}this.addfunc(Q,K,p);N+=2;M=(C|o|k|i)}else{if(this.isConst()){if((M&C)===0){this.error_parsing(this.pos,"unexpected constant")}var I=new A(h,0,0,this.tokennumber);Q.push(I);M=(r|e|u)}else{if(this.isOp2()){if((M&k)===0){this.error_parsing(this.pos,"unexpected function")}this.addfunc(Q,K,p);N+=2;M=(o)}else{if(this.isOp1()){if((M&k)===0){this.error_parsing(this.pos,"unexpected function")}this.addfunc(Q,K,q);N++;M=(o)}else{if(this.isVar()){if((M&C)===0){this.error_parsing(this.pos,"unexpected variable")}var O=new A(s,this.tokenindex,0,0);Q.push(O);M=(r|e|u|o|g)}else{if(this.isWhite()){}else{if(this.errormsg===""){this.error_parsing(this.pos,"unknown character")}else{this.error_parsing(this.pos,this.errormsg)}}}}}}}}}}}}}if(this.tmpprio<0||this.tmpprio>=10){this.error_parsing(this.pos,'unmatched "()"')}while(K.length>0){var L=K.pop();Q.push(L)}if(N+1!==Q.length){this.error_parsing(this.pos,"parity")}return new G(Q,H(this.ops1),H(this.ops2),H(this.functions))},evaluate:function(I,J){return this.parse(I).evaluate(J)},error_parsing:function(I,J){this.success=false;this.errormsg="parse error [column "+(I)+"]: "+J;throw new Error(this.errormsg)},addfunc:function(L,I,K){var J=new A(K,this.tokenindex,this.tokenprio+this.tmpprio,0);while(I.length>0){if(J.prio_<=I[I.length-1].prio_){L.push(I.pop())}else{break}}I.push(J)},isNumber:function(){var J=false;var K="";while(this.pos<this.expression.length){var I=this.expression.charCodeAt(this.pos);if((I>=48&&I<=57)||I===46){K+=this.expression.charAt(this.pos);this.pos++;this.tokennumber=parseFloat(K);J=true}else{break}}return J},unescape:function(J,O){var I=[];var N=false;for(var L=0;L<J.length;L++){var M=J.charAt(L);if(N){switch(M){case"'":I.push("'");break;case"\\":I.push("\\");break;case"/":I.push("/");break;case"b":I.push("\b");break;case"f":I.push("\f");break;case"n":I.push("\n");break;case"r":I.push("\r");break;case"t":I.push("\t");break;case"u":var K=parseInt(J.substring(L+1,L+5),16);I.push(String.fromCharCode(K));L+=4;break;default:throw this.error_parsing(O+L,"Illegal escape sequence: '\\"+M+"'")}N=false}else{if(M=="\\"){N=true}else{I.push(M)}}}return I.join("")},isString:function(){var J=false;var L="";var K=this.pos;if(this.pos<this.expression.length&&this.expression.charAt(this.pos)=="'"){this.pos++;while(this.pos<this.expression.length){var I=this.expression.charAt(this.pos);if(I!="'"||L.slice(-1)=="\\"){L+=this.expression.charAt(this.pos);this.pos++}else{this.pos++;this.tokennumber=this.unescape(L,K);J=true;break}}}return J},isConst:function(){var K;for(var J in this.consts){if(true){var I=J.length;K=this.expression.substr(this.pos,I);if(J===K){this.tokennumber=this.consts[J];this.pos+=I;return true}}}return false},isOperator:function(){var I=this.expression.charCodeAt(this.pos);if(I===43){this.tokenprio=0;this.tokenindex="+"}else{if(I===45){this.tokenprio=0;this.tokenindex="-"}else{if(I===124){if(this.expression.charCodeAt(this.pos+1)===124){this.pos++;this.tokenprio=0;this.tokenindex="||"}else{return false}}else{if(I===42){this.tokenprio=1;this.tokenindex="*"}else{if(I===47){this.tokenprio=2;this.tokenindex="/"}else{if(I===37){this.tokenprio=2;this.tokenindex="%"}else{if(I===94){this.tokenprio=3;this.tokenindex="^"}else{return false}}}}}}}this.pos++;return true},isSign:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===45||I===43){return true}return false},isPositiveSign:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===43){return true}return false},isNegativeSign:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===45){return true}return false},isLeftParenth:function(){var I=this.expression.charCodeAt(this.pos);if(I===40){this.pos++;this.tmpprio+=10;return true}return false},isRightParenth:function(){var I=this.expression.charCodeAt(this.pos);if(I===41){this.pos++;this.tmpprio-=10;return true}return false},isComma:function(){var I=this.expression.charCodeAt(this.pos);if(I===44){this.pos++;this.tokenprio=-1;this.tokenindex=",";return true}return false},isWhite:function(){var I=this.expression.charCodeAt(this.pos);if(I===32||I===9||I===10||I===13){this.pos++;return true}return false},isOp1:function(){var J="";for(var I=this.pos;I<this.expression.length;I++){var K=this.expression.charAt(I);if(K.toUpperCase()===K.toLowerCase()){if(I===this.pos||(K!="_"&&(K<"0"||K>"9"))){break}}J+=K}if(J.length>0&&(J in this.ops1)){this.tokenindex=J;this.tokenprio=5;this.pos+=J.length;return true}return false},isOp2:function(){var J="";for(var I=this.pos;I<this.expression.length;I++){var K=this.expression.charAt(I);if(K.toUpperCase()===K.toLowerCase()){if(I===this.pos||(K!="_"&&(K<"0"||K>"9"))){break}}J+=K}if(J.length>0&&(J in this.ops2)){this.tokenindex=J;this.tokenprio=5;this.pos+=J.length;return true}return false},isVar:function(){var J="";for(var I=this.pos;I<this.expression.length;I++){var K=this.expression.charAt(I);if(K.toUpperCase()===K.toLowerCase()){if(I===this.pos||(K!="_"&&(K<"0"||K>"9"))){break}}J+=K}if(J.length>0){this.tokenindex=J;this.tokenprio=4;this.pos+=J.length;return true}return false},isComment:function(){var I=this.expression.charCodeAt(this.pos-1);if(I===47&&this.expression.charCodeAt(this.pos)===42){this.pos=this.expression.indexOf("*/",this.pos)+2;if(this.pos===1){this.pos=this.expression.length}return true}return false}};d.Parser=c;return c})(typeof exports==="undefined"?{}:exports);